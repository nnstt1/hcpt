# hcpt

A CLI tool for retrieving HCP Terraform configurations and workspace information.

[日本語](README.ja.md)

## Installation

### Go install

```bash
go install github.com/nnstt1/hcpt@latest
```

### GitHub Releases

Download binaries from [Releases](https://github.com/nnstt1/hcpt/releases).

## Authentication

API tokens are resolved in the following priority order:

1. `TFE_TOKEN` environment variable
2. `token` field in `~/.hcpt.yaml`
3. Terraform CLI credentials (checked in the following order)
   1. `TF_TOKEN_<hostname>` environment variable (dots and dashes in hostname are replaced with underscores, e.g. `TF_TOKEN_app_terraform_io`)
   2. `~/.terraform.d/credentials.tfrc.json` (JSON generated by `terraform login`)
   3. `~/.terraformrc` (HCL credentials block)

If you have already authenticated with `terraform login`, hcpt works without additional configuration.

```bash
# Use directly after terraform login
terraform login
hcpt org list
```

```yaml
# ~/.hcpt.yaml
token: "your-api-token"
address: "https://app.terraform.io"  # default
org: "my-organization"
```

The address can also be set via the `TFE_ADDRESS` environment variable.

The path to `~/.terraformrc` can be overridden with the `TF_CLI_CONFIG_FILE` environment variable.

## Usage

### Organizations

```bash
# List organizations
hcpt org list

# Show organization details, subscription plan, and entitlements
hcpt org show --org my-org
```

### Projects

```bash
# List projects in an organization
hcpt project list --org my-org
```

### Workspaces

```bash
hcpt workspace list --org my-org

# Search by name
hcpt workspace list --org my-org --search "prod"

# Alias `ws` is also available
hcpt ws list --org my-org

# Show workspace details
hcpt workspace show my-workspace --org my-org

# Show drift detection status for a workspace
hcpt workspace drift my-workspace --org my-org

# Show drift status for all workspaces
hcpt workspace drift --all --org my-org
```

### Runs

```bash
# List runs for a workspace
hcpt run list --org my-org -w my-workspace

# Show run details
hcpt run show run-abc123
```

### Variables

```bash
# List variables for a workspace
hcpt variable list --org my-org -w my-workspace

# Alias `var` is also available
hcpt var list --org my-org -w my-workspace

# Create or update a variable (upsert)
hcpt variable set MY_KEY "my-value" --org my-org -w my-workspace

# Set an environment variable
hcpt variable set AWS_REGION "us-east-1" --org my-org -w my-workspace --category env

# Set a sensitive variable
hcpt variable set SECRET_KEY "s3cret" --org my-org -w my-workspace --sensitive

# Set an HCL variable
hcpt variable set my_list '["a","b"]' --org my-org -w my-workspace --hcl

# Delete a variable
hcpt variable delete MY_KEY --org my-org -w my-workspace
```

### Configuration

```bash
# Set default organization
hcpt config set org my-org

# Set API address
hcpt config set address https://tfe.example.com

# Set API token
hcpt config set token your-api-token

# Get a configuration value
hcpt config get org

# List all configuration values (tokens are masked)
hcpt config list
```

Values are saved to `~/.hcpt.yaml`. Existing values are preserved.

### Common Options

| Flag | Description |
|------|-------------|
| `--org` | Organization name (can also be set in config file or environment variable) |
| `--json` | Output in JSON format |
| `--config` | Config file path (default: `~/.hcpt.yaml`) |

## Development

```bash
# Build
make build

# Test
make test

# Lint
make lint

# Clean
make clean
```

## License

MIT
